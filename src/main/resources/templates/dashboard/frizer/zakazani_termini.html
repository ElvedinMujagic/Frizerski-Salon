<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Zakazani Termini</title>
  <th:block th:insert="~{fragments :: resources}"></th:block>
  <script th:if="${session.user != null }" th:src="@{/js/overlaysScript.js}"></script>
</head>
<body>
<div th:replace="~{fragments::navbar}"></div>
<main>
  <div th:if="${session.user != null}" class="border-wrapper" >
    <div class="main-wrapper">
      <p th:replace="~{fragments :: dashboard_head}"></p>
      <div class="content-wrapper">
        <div th:replace=" ~{fragments :: role-buttons}"></div>
        <div style="padding:2vw;justify-content: flex-start;" class="forms" >
          <div class="table_positioning">
            <div  style="width: 90%;" class="table_width">
              <div class="container">
                <table style="width: 100%">
                  <thead>
                  <tr>
                    <th scope="col">ID</th>
                    <th scope="col">Usluga</th>
                    <th scope="col">Cijena(KM)</th>
                    <th scope="col">Trajanje(min)</th>
                    <th scope="col">Klijent</th>
                    <th scope="col">Datum</th>
                  </tr>
                  </thead>
                  <tbody>
                  <tr th:each="termin : ${termini}">
                    <th th:text="${termin.id}"></th>
                    <td th:text="${termin.usluge.get(0).naziv}"></td>
                    <td th:text="${termin.usluge.get(0).cijena}"></td>
                    <td th:text="${termin.usluge.get(0).trajanje}"></td>
                    <td th:text="${termin.user.ime + ' ' + termin.user.prezime}"></td>
                    <td th:text="${termin.datum_termina}"></td>
                    <td>
                      <form th:object ="${terminDTO}" id="otkaziForm"
                            class="table-attribute"
                            action="/cancel_termin_request"
                            method="POST">
                        <button type="button" id="openOtkaziOverlayBtn"><i>Otkazi</i></button>
                        <div id="otkazi_overlay" class="overlay">
                          <div class="overlay-content">
                            <h2>Otkazivanje Termina</h2>
                            <label>Razlog otkazivanja:</label>
                            <br>
                            <div class="form-input" style="margin-bottom: 0">
                              <textarea class="form-input" id="canceled_reason" rows="4" cols="50"
                                        th:field="*{cancellation_reason}"></textarea>
                            </div>
                            <br>
                            <input type="hidden"
                                   name="terminId"
                                   th:value="${termin.id}"/>
                            <!-- Ovaj input za "canceled" nije potreban-->
                            <input type="hidden"
                                   th:field="*{canceled}"
                                   th:value="${true}"/>
                            <button type="submit">Po≈°alji</button>
                            <button type="button" id="closeOtkaziOverlayBtn">Zatvori</button>
                          </div>
                        </div>
                      </form>
                    </td>
                    <td>
                      <form th:object ="${terminDTO}"
                            class="table-attribute"
                            action="/potvrdi_termin_request"
                            method="POST"
                            id="potvrdiForm">
                        <button type="button" id="greenBtn">Potvrdi</button>
                        <div id="potvrdi_overlay" class="overlay">
                          <div class="overlay-content">
                            <h2>Potvrda Termina</h2>
                            <label>Vrijeme termina:</label>
                            <div class="form-input" style="margin-bottom: 0">
                              <input type="time" onclick="this.showPicker()"
                                     min="09:00"
                                     max="17:00"
                                     value="10:00"
                                     th:field="*{time}"
                                     class="form-input" id="time">
                            </div>
                            <br>
                            <input type="hidden" name="terminId" th:value="${termin.id}"/>
                            <button type="submit">Potvrdi</button>
                            <button type="button" id="closePotvrdiOverlay">Zatvori</button>
                          </div>
                        </div>
                      </form>
                    </td>
                  </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
          <div><p class="error-style" th:text="${error}"></p></div>
        </div>
      </div>
    </div>
  </div>
</main>
</body>
</html>